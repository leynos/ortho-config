#!/usr/bin/env bash
set -euo pipefail

real_cargo="${PUBLISH_CHECK_CARGO_REAL:-}"
if [[ -z "${real_cargo}" ]]; then
  real_cargo="$(command -pv cargo)"
fi

if [[ "$#" -eq 0 ]]; then
  exec "${real_cargo}"
fi

subcommand="$1"
shift

if [[ "${subcommand}" == "check" || "${subcommand}" == "test" ]]; then
  exec "${real_cargo}" "${subcommand}" "$@" --all-features
fi

exec "${real_cargo}" "${subcommand}" "$@"
